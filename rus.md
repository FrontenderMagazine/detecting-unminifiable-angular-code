# Обнаружение неминифицируемого Ангуляр кода

Когда вы пишете Ангуляр-компоненты, например, контроллеры, сервисы или директивы, вы можете указать все зависимости, которые необходимы для работы. Инъекция ангуляра потом будет разрешать их и делать доступными для вашего компонента.

Самый простой путь указать зависимости - это назвать аргументы фабричного метода вашего компонента или конструктора так же, как называются требуемые компоненты:

    angular
        .module("someModule")
        .factory("someService", function($http, $q) {
            // ...
        });

Но при таком подходе есть один недостаток: инъекция зависимостей разрешит их, основываясь на именах аргументов, но такое решение **не работает с минифицированным кодом**. В этом случае, параметры обычно сокращают до однобуквенных переменных, тем самым делая невозможным использование их имен для разрешения зависимостей.

Ангуляр предлагает решение этой проблемы. Если указать имена зависимостей явно в виде строк, а не полагаться на точное совпадение имена аргументов, ваши компоненты становятся **минифицированно-безопасными**. Вам просто нужно убедиться, что порядок строк, соответствует порядку параметров в методе фабрики или функции конструктора:

    angular
        .module("someModule")
        .factory("someService", ["$http", "$q", function($http, $q) {
            // ...
        }]);

Вместо того, чтобы явно прописывать массив, вы можете использовать функцию со свойством `$inject`, которое просто позволит записать массив зависимости имен. Этот синтаксис я предпочитаю использовать:

    angular
        .module("someModule")
        .factory("someService", someService);
    
    someService.$inject = ["$http", "$q"];
    
    function someService($http, $q) {
        // ...
    }

В любом случае, код теперь может быть минимизирован без проблем. Но оба подхода имеют недостаток. Вы заметите, что ваш код не работает только тогда, когда его минифицируете, выполните и запустите в разрешении зависимостей. Было бы лучше, если бы код падал **быстро** и **рано**.

Чтобы так и было, вы можете использовать атрибут `ng-strict-di` который заставит Ангуляр работать именно так. Этот атрибут применяется на самом элементе приложения:

    <html ng-app="someModule" ng-strict-di>
        <!-- ... -->
    </html>

Цитата из [Ангуляр документации][1], вот что говорится:

> Если этот атрибут присутствует на элементе приложения, инжектор будет создан в режиме `ng-strict-di`. Это означает, что приложение не сможет вызывать функции, которые явно не используют аннотацию функций (и, таким образом, непригодны для минификации), как описано в [справочнике Инъекции Зависимости][2], и полезная отладочная информация будет помогать в поиске корня этих ошибок.

Использование строгого режима инъекции зависимостей позволяет обнаружить, что компонента Ангуляра непригодна для минификации без попытки самой минификации кода. Вы должны добавить `ng-strict-di` к вашему элементу приложения, если вы этого еще не сделали!

 [1]: https://docs.angularjs.org/api/ng/directive/ngApp
 [2]: https://docs.angularjs.org/guide/di
 [3]: https://twitter.com/share